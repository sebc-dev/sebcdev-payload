# Phase 1: TOC Data Extraction - Validation Checklist

**Story**: 4.2 - Table des Matières (TOC) & Progression
**Phase**: 1 - TOC Data Extraction
**Validator**: _________________
**Date**: _________________

---

## Instructions

Complete this checklist before marking Phase 1 as complete. All items must be checked for the phase to be considered done.

### Validation Steps

1. Run all automated checks
2. Verify each file exists and has correct content
3. Test manually if needed
4. Sign off at the bottom

---

## 1. Automated Quality Checks

### TypeScript Compilation

```bash
pnpm exec tsc --noEmit
```

- [ ] No TypeScript errors
- [ ] No TypeScript warnings

### ESLint

```bash
pnpm lint
```

- [ ] No ESLint errors
- [ ] No ESLint warnings (or only acceptable warnings)

### Unit Tests

```bash
pnpm test:unit tests/unit/lib/toc/
```

- [ ] All tests pass
- [ ] No skipped tests
- [ ] No focused tests (.only)

### Test Coverage

```bash
pnpm test:unit --coverage tests/unit/lib/toc/
```

- [ ] Statement coverage > 80%
- [ ] Branch coverage > 80%
- [ ] Function coverage > 80%
- [ ] Line coverage > 80%

**Actual Coverage**:
| Metric | Value |
|--------|-------|
| Statements | ___% |
| Branches | ___% |
| Functions | ___% |
| Lines | ___% |

---

## 2. File Existence Verification

### New Files

```bash
ls -la src/lib/toc/
```

- [ ] `src/lib/toc/types.ts` exists
- [ ] `src/lib/toc/slugify.ts` exists
- [ ] `src/lib/toc/extract-headings.ts` exists
- [ ] `src/lib/toc/index.ts` exists

```bash
ls -la tests/unit/lib/toc/
```

- [ ] `tests/unit/lib/toc/extract-headings.spec.ts` exists

### Modified Files (if Commit 4 completed)

- [ ] `src/components/richtext/nodes/Heading.tsx` modified to use shared slugify

---

## 3. Export Verification

### Import Test

Create a temporary file or use Node REPL:

```typescript
// Test these imports work
import { extractTOCHeadings, slugify } from '@/lib/toc'
import type { TOCHeading, TOCData, TOCExtractionInput } from '@/lib/toc'
```

- [ ] All named exports importable
- [ ] All type exports importable
- [ ] No circular dependency warnings

### API Surface

Verify these are exported from `@/lib/toc`:

| Export | Type | Verified |
|--------|------|----------|
| `TOCHeading` | type | [ ] |
| `TOCData` | type | [ ] |
| `TOCExtractionInput` | type | [ ] |
| `slugify` | function | [ ] |
| `extractTOCHeadings` | function | [ ] |

---

## 4. Functional Verification

### slugify() Function

| Test | Input | Expected | Actual | Pass |
|------|-------|----------|--------|------|
| Lowercase | `"Hello"` | `"hello"` | | [ ] |
| Spaces | `"hello world"` | `"hello-world"` | | [ ] |
| Accents | `"café"` | `"cafe"` | | [ ] |
| Special | `"test!"` | `"test"` | | [ ] |
| Empty | `""` | `""` | | [ ] |

### extractTOCHeadings() Function

| Test | Scenario | Expected | Pass |
|------|----------|----------|------|
| Null input | `null` | `[]` | [ ] |
| h2 heading | Single h2 | 1 item, level 2 | [ ] |
| h3 heading | Single h3 | 1 item, level 3 | [ ] |
| h1 ignored | h1 + h2 | 1 item (h2 only) | [ ] |
| Empty heading | h2 with "" | 0 items | [ ] |

---

## 5. Integration Verification

### Heading.tsx Compatibility

If Commit 4 completed:

```bash
# Start dev server
pnpm dev

# Navigate to an article page
# Open browser DevTools > Elements
# Check heading IDs match expected format
```

- [ ] Dev server starts without errors
- [ ] Article page renders correctly
- [ ] Heading IDs are URL-friendly (lowercase, hyphenated)
- [ ] No console errors related to headings

### ID Matching Test

Compare IDs generated by:
1. `slugify("Test Heading")` in @/lib/toc
2. ID attribute on rendered `<h2>Test Heading</h2>`

- [ ] IDs match exactly

---

## 6. Documentation Verification

### JSDoc Comments

| File | JSDoc Present | Quality |
|------|---------------|---------|
| `types.ts` | [ ] | [ ] Good |
| `slugify.ts` | [ ] | [ ] Good |
| `extract-headings.ts` | [ ] | [ ] Good |
| `index.ts` | [ ] | [ ] Good |

**JSDoc Quality Criteria**:
- `@param` for all parameters
- `@returns` with description
- `@example` with realistic usage

---

## 7. Git Verification

### Commits

```bash
git log --oneline -5
```

| # | Commit Message | Gitmoji | Verified |
|---|----------------|---------|----------|
| 1 | feat(toc): add types and slugify... | ✨ | [ ] |
| 2 | feat(toc): implement extractTOCHeadings... | ✨ | [ ] |
| 3 | test(toc): add comprehensive unit tests... | ✅ | [ ] |
| 4 | refactor(richtext): use shared slugify... | ♻️ | [ ] |

- [ ] 3-4 commits present
- [ ] Commit messages follow convention
- [ ] Each commit is atomic
- [ ] No merge commits (unless intentional)

### Branch Status

```bash
git status
```

- [ ] No uncommitted changes
- [ ] On correct branch (`feature/story-4.2-phase-1`)

---

## 8. Success Criteria Verification

From PHASES_PLAN.md Phase 1 Success Criteria:

- [ ] `extractTOCHeadings` returns headings h2/h3 with id and text
- [ ] Generated IDs match those of Heading.tsx component
- [ ] Tests: 100% of edge cases covered (5+ tests)
- [ ] Type `TOCHeading` and `TOCData` defined
- [ ] Function `extractTOCHeadings(content: LexicalContent): TOCHeading[]`
- [ ] Tests covering different cases (h2 only, h2+h3, empty, nested)
- [ ] Export from `@/lib/toc`

---

## 9. Blockers for Next Phases

Verify Phase 1 unblocks:

### Phase 3 Requirements

- [ ] `extractTOCHeadings()` can be imported
- [ ] Returns correct data structure for TOC component
- [ ] Handles real article content correctly

---

## 10. Sign-Off

### Validation Summary

| Category | Status |
|----------|--------|
| TypeScript | [ ] Pass |
| ESLint | [ ] Pass |
| Unit Tests | [ ] Pass |
| Coverage | [ ] Pass |
| Files Exist | [ ] Pass |
| Exports Work | [ ] Pass |
| Integration | [ ] Pass |
| Documentation | [ ] Pass |
| Git Status | [ ] Pass |

### Final Checklist

- [ ] All automated checks pass
- [ ] All files created/modified as expected
- [ ] All exports accessible
- [ ] Integration verified
- [ ] Documentation complete
- [ ] Ready for Phase 2/3

### Approval

**Validator Name**: _________________

**Date**: _________________

**Signature**: _________________

**Notes**:
```
[Add any notes, issues found, or follow-up items here]
```

---

## Post-Validation Actions

After validation is complete:

1. [ ] Update PHASES_PLAN.md with actual metrics
2. [ ] Update EPIC_TRACKING.md with phase completion
3. [ ] Create PR for review (if not done)
4. [ ] Notify team phase is ready for review
5. [ ] Begin Phase 2 or Phase 3 (can be parallel)

---

**Validation Checklist Generated**: 2025-12-10
**Last Updated**: 2025-12-10
